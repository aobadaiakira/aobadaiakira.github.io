<!DOCTYPE html>
<html lang="ja">

<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>小説家になろう記法からカクヨム記法への変換 | ウェブ・ツール | 青葉台旭</title>
<link rel="stylesheet" type="text/css"  href="index.css">
<link rel="icon"       type="image/png" href="./favicon.png">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-67878421-6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-67878421-6');
</script>
</head>

<!-- ====================================================================== -->

<!-- ===== body ===== -->
<body>
<div class="base_sheet">
<div class="base_container">

<!-- ===== header ===== -->
<header>
  <div class="h1_and_button">
    <div class="button_in_header">
      |<a href="../index.html">上へ</a>|
    </div>
    <h1>小説家になろう記法からカクヨム記法への変換</h1>
  </div>
</header>

<!-- ========== content ========== -->
<div class="content">

<!-- ===== ページ説明 ===== -->
<section class="description">
<h2>免責</h2>
<p>
  以下のウェブ・ツールは、私（青葉台旭）が自分自身で使うために作りました。<br>
  一般公開をしていても、私以外の方が使用する事を想定して作られてはいません。<br>
  私以外の方が使用した結果生じた、いかなる損害に対しても青葉台旭は一切の責任を負いません。
</p>
</section>

<section class="description">
<h2>このページについて</h2>
<p>
  小説家になろう記法で書かれた原稿をカクヨム記法に変換します。<br>
  「変換前」テキストエリアに小説家になろう記法で書かれた文章をコピーして貼り付け、
  「ここを押すと変換されます」というボタンをクリックすると
  「変換後」テキストエリアにカクヨム記法に変換された文章が現れるので、
  それをコピーしてカクヨムの編集画面に貼り付けることで
  簡単に小説家になろうからカクヨムへ文章を移すことが出来ます。
</p>
</section>

<!-- ===== アプリケーション部分 ===== -->
<section>
  <h2>実行画面</h2>
  <p class="textarea">
    <span class="textarea_title">変換前</span><br>
    <textarea id="source" rows="15" cols="40" placeholder="小説家になろう記法の文章を貼り付けてください"></textarea>
  </p>
  <p>
    <button type="button" id="convert" onclick="AobadaiAkira.naro2kaku.onClickConvertButton()">
      ここを押すと変換されます
    </button>
    <button type="button" id="clear" onclick="AobadaiAkira.naro2kaku.onClickClearButton()">
      クリア
    </button>
  </p>
  <p class="textarea">
    <span class="textarea_title">変換後</span><br>
    <textarea id="result" rows="15" cols="40" placeholder="カクヨム記法の文章が出力されます"></textarea>
  </p>
</section>

<!-- ===== 補足事項 ===== -->
<section>
  <h2>補足事項</h2>
  <section>
    <h3>仕様</h3>
    <section>
      <h4>1.傍点の変換</h4>
      <p>
        小説家になろう記法の傍点<br>
        ｜ぼ《・》｜う《・》｜て《・》｜ん《・》<br>
        を、カクヨム記法の傍点<br>
        《《ぼうてん》》<br>
        に、変換します。
      </p>
    </section>
    <section>
      <h4>2.ルビの変換</h4>
      <p>
        小説家になろうのルビには複数の形式があります。
      </p>
      <ul>
        <li>｜任意の文字列《任意の文字列》</li>
        <li>漢字《任意の文字列》</li>
        <li>漢字（ひらがな又はカタカナ）</li>
      </ul>
      <p>
        これらを全て「｜任意の文字列《任意の文字列》」形式に統一します。<br>
        また「｜」は、全角・半角どちらでもよいことになっていますが、これを全角に統一します。<br>
        丸カッコは左右のペアが全角なら全角、半角なら半角に統一されていなければいけません。
      </p>
    </section>
    <section>
      <h4>3.丸カッコのエスケープの削除</h4>
      <p>
        小説家になろうでは、丸カッコの直前に「｜」を挿入するとエスケープされて丸カッコのまま表示されます。<br>
        それを再現するために丸カッコの直前に「｜」があった場合は、それを削除します。<br>
      </p>
    </section>
    <section>
      <h4>4.その他</h4>
      <p>
        あらゆる記述に対して検証している訳ではありませんので、
        実際の「小説家になろう」における挙動とは多少違う部分があるかも知れません。<br>
        特に、ルビなどで修飾されるべき文字列の中に「｜」や「《》」や、
        丸カッコなどのメタ文字自身が混入している時の挙動には気をつけてください。
      </p>
    </section>

  </section>
  <section>
    <h3>転記元</h3>
    <p>
      このウェブ・ツールは、青葉台旭が２０１６年に、<br>
      <a href="http://aobadaiakira.webcrow.jp/">aobadaiakira.webcrow.jp</a><br>
      にて公開したものに若干の変更を加えて転記しました。<br>
      元のページのURLは既に削除済みですが、
      「<a href="http://aobadaiakira.jp/archive/webcrow_20170314/WebTool/NaroToKaku/index.html">青葉台旭の保管庫</a>」
      に元のファイルを保管してあります。
    </p>
  </section>
</section>

<!-- ====================================================================== -->
<!-- ===== javascript ===== -->
<script>

// 青葉台旭の名前空間
if (typeof AobadaiAkira === "undefined") {
  var AobadaiAkira = {};
}

// naro2kakuの名前空間
AobadaiAkira.naro2kaku = {};

// ============================================================================
// 消去ボタンが押された。
AobadaiAkira.naro2kaku.onClickClearButton = function() {

  var input_str  = document.getElementById ('source');
  var output_str = document.getElementById ('result');

  input_str.value  = "";
  output_str.value = "";
}

// ============================================================================
// 変換ボタンが押された。
AobadaiAkira.naro2kaku.onClickConvertButton = function() {

  var input_str  = document.getElementById ('source');
  var output_str = document.getElementById ('result');

  // 改行コードを\nに統一する。
  var s = input_str.value.replace(/\r\n|\r/g, "\n");

  // 改行コードで分割する。
  var lines = s.split("\n");

  // 結果の文字列
  var result = "";
  var firstLine = true;
  var line = "";

  // 行ごとの処理
  for (var i = 0; i < lines.length; i++) {

    // 変換
    line = this.convert(lines[i]);

    if (firstLine) { firstLine = false; }
    else           { result += "\n";    }
    result += line;
  }

  // 結果表示用テキストエリア
  output_str.value = result;
};

// ============================================================================
// 小説家になろう形式からカクヨム形式への変換。
AobadaiAkira.naro2kaku.convert = function(s) {

  // 傍点を変換する。
  var s1 = s.replace(/((\||｜).《・》)+/g, function(matchStr) {
    var sidedot = ""
    for (var j = 0; j < matchStr.length; j += 5) {
      sidedot += matchStr.charAt(j + 1);
    }
    return ("《《" + sidedot + "》》");
  });

  var rubyLeft   = "<AOBADAI_AKIRA_RUBY_1>";
  var rubyCenter = "<AOBADAI_AKIRA_RUBY_2>";
  var rubyRight  = "<AOBADAI_AKIRA_RUBY_3>";

  // ルビ："｜" または"|" + 吾輩《わがはい》
  var s2 = s1.replace(
    /(\||｜)[^\|^｜^《]+《[^《^》]+》/g,
    function(matchStr) {

    var array = matchStr.split("《");
    var rubyA = array[0].substring(1);
    var rubyB = array[1].substring(0, array[1].length - 1);
    return (rubyLeft + rubyA + rubyCenter + rubyB + rubyRight);
  });

  // ルビ：漢字《かんじ》
  var s3 = s2.replace(/[一-龠々]+《[^《^》]+》/g, function(matchStr) {
    var array = matchStr.split("《");
    var rubyA = array[0];
    var rubyB = array[1].substring(0, array[1].length - 1);
    return (rubyLeft + rubyA + rubyCenter + rubyB + rubyRight);
  });

  // ルビ：漢字（かな）　全角丸かっこ
  var s4 = s3.replace(
    /[一-龠々]+（[\u3040-\u309F\u30A0-\u30FF]+）/g, function(matchStr) {

    var array = matchStr.split("（");
    var rubyA = array[0];
    var rubyB = array[1].substring(0, array[1].length - 1);
    return (rubyLeft + rubyA + rubyCenter + rubyB + rubyRight);
  });

  // ルビ：漢字(かな)　半角丸かっこ
  var s5 = s4.replace(
    /[一-龠々]+\([\u3040-\u309F\u30A0-\u30FF]+\)/g, function(matchStr) {

    var array = matchStr.split("(");
    var rubyA = array[0];
    var rubyB = array[1].substring(0, array[1].length - 1);
    return (rubyLeft + rubyA + rubyCenter + rubyB + rubyRight);
  });

  // 丸かっこのエスケープ
  var s6 = s5.replace(/(\||｜)（.*）/g, function(matchStr) {
    return matchStr.substring(1);
  });

  // 丸かっこ（半角）のエスケープ
  var s7 = s6.replace(/(\||｜)\(.*\)/g, function(matchStr) {
    return matchStr.substring(1);
  });

  // 仮のタグを元に戻す
  var s8 = s7.replace(new RegExp(rubyLeft, "g"), "｜")
  var s9 = s8.replace(new RegExp(rubyCenter, "g"), "《")
  var result = s9.replace(new RegExp(rubyRight, "g"), "》");

  return result;
};
</script>

</div>
<!-- ========== content end ========== -->

<footer>
  <div class="auther_in_footer">
    作者 <span class="author">青葉台旭</span>
  </div>
  <div class="button_in_footer">
    |<a href="../index.html">上へ</a>|
  </div>
</footer>

</div> <!-- div.base_container end-->
</div> <!-- div.base_sheet end-->

</body>
</html>